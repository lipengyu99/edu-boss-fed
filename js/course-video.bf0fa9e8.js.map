{"version":3,"sources":["webpack:///./src/views/course/video.vue?4239","webpack:///./src/api/aliyun-oss.ts","webpack:///./src/views/course/video.vue","webpack:///./src/views/course/video.vue?f941","webpack:///./src/views/course/video.vue?7326","webpack:///./node_modules/core-js/modules/es.function.name.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","ref","on","authUpload","_v","$event","$router","back","uploadPercent","_s","_e","isTranscodeSuccess","staticRenderFns","request","method","url","params","data","lessonId","uploader","videoId","imageUrl","fileName","isUploadSuccess","initUploader","videoFile","$refs","files","addFile","name","startUpload","window","AliyunUpload","Vod","userId","region","partSize","parallel","retryCount","retryDuration","onUploadstarted","uploadInfo","console","log","uploadAuthInfo","isImage","imageURL","file","setUploadAuthAndAddress","uploadAuth","uploadAddress","imageId","onUploadSucceed","onUploadFailed","code","message","onUploadProgress","totalSize","loadedPercent","onUploadTokenExpired","onUploadEnd","$route","query","fileId","coverImageUrl","timer","setInterval","$message","success","clearInterval","component","DESCRIPTORS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","match","error"],"mappings":"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","file":"js/course-video.bf0fa9e8.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\"},[_c('el-card',[_c('el-form',{attrs:{\"label-width\":\"40px\"}},[_c('el-form-item',{attrs:{\"label\":\"视频\"}},[_c('input',{ref:\"video-file\",attrs:{\"type\":\"file\"}})]),_c('el-form-item',{attrs:{\"label\":\"封面\"}},[_c('input',{ref:\"image-file\",attrs:{\"type\":\"file\"}})]),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.authUpload}},[_vm._v(\"开始上传\")]),_c('el-button',{on:{\"click\":function($event){return _vm.$router.back()}}},[_vm._v(\"返回\")])],1),_c('el-form-item',[(_vm.uploadPercent !== 0)?_c('p',[_vm._v(\"视频上传中: \"+_vm._s(_vm.uploadPercent)+\"%\")]):_vm._e(),(_vm.isUploadSuccess)?_c('p',[_vm._v(\" 视频转码中：\"+_vm._s(_vm.isTranscodeSuccess ? '完成' : '正在转码中...')+\" \")]):_vm._e()])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\n * 阿里云上传\n */\n\nimport request from '@/utils/request'\n\nexport const aliyunImagUploadAddressAdnAuth = () => {\n  return request({\n    method: 'GET',\n    url: '/boss/course/upload/aliyunImagUploadAddressAdnAuth.json'\n  })\n}\n\nexport const aliyunVideoUploadAddressAdnAuth = (params: any) => {\n  return request({\n    method: 'GET',\n    url: '/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json',\n    params\n  })\n}\n\nexport const transCodeVideo = (data: any) => {\n  return request({\n    method: 'POST',\n    url: '/boss/course/upload/aliyunTransCode.json',\n    data\n  })\n}\n\nexport const getAliyunTransCodePercent = (lessonId: string | number) => {\n  return request({\n    method: 'GET',\n    url: '/boss/course/upload/aliyunTransCodePercent.json',\n    params: {\n      lessonId\n    }\n  })\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Vue } from 'vue-property-decorator'\nimport {\n  aliyunImagUploadAddressAdnAuth,\n  aliyunVideoUploadAddressAdnAuth,\n  transCodeVideo,\n  getAliyunTransCodePercent\n} from '@/api/aliyun-oss'\n@Component\nexport default class Video extends Vue {\n  private uploader: any = null\n  private videoId = null\n  private imageUrl = ''\n  private fileName = ''\n  private uploadPercent = 0\n  private isUploadSuccess = false\n  private isTranscodeSuccess = false\n\n  private created () {\n    this.initUploader()\n  }\n\n  private authUpload () {\n    const videoFile = (this.$refs['video-file'] as any).files[0]\n    this.uploader.addFile(videoFile, null, null, null, '{\"Vod\":{}}')\n    this.uploader.addFile(\n      (this.$refs['image-file'] as any).files[0],\n      null,\n      null,\n      null,\n      '{\"Vod\":{}}'\n    )\n    this.fileName = videoFile.name\n    this.uploader.startUpload()\n  }\n\n  private initUploader () {\n    this.uploader = new window.AliyunUpload.Vod({\n      // 阿里账号ID，必须有值 ，值的来源https://help.aliyun.com/knowledge_detail/37196.html\n      userId: 1618139964448548,\n      // 上传到点播的地域， 默认值为'cn-shanghai',//eu-central-1,ap-southeast-1\n      region: 'cn-shanghai',\n      // 分片大小默认1M，不能小于100K\n      partSize: 1048576,\n      // 并行上传分片个数，默认5\n      parallel: 5,\n      // 网络原因失败时，重新上传次数，默认为3\n      retryCount: 3,\n      // 网络原因失败时，重新上传间隔时间，默认为2秒\n      retryDuration: 2,\n      // 开始上传\n      onUploadstarted: async (uploadInfo: {\n        isImage: any\n        file: { name: any }\n      }) => {\n        console.log('onUploadstarted', uploadInfo)\n        let uploadAuthInfo = null\n        if (uploadInfo.isImage) {\n          // 图片\n          const { data } = await aliyunImagUploadAddressAdnAuth()\n          this.imageUrl = data.data.imageURL\n          uploadAuthInfo = data.data\n        } else {\n          // 视频\n          const { data } = await aliyunVideoUploadAddressAdnAuth({\n            fileName: uploadInfo.file.name,\n            imageUrl: this.imageUrl\n          })\n          this.videoId = data.data.videoId\n          uploadAuthInfo = data.data\n        }\n\n        // console.log('uploadAuthInfo', uploadAuthInfo)\n\n        this.uploader.setUploadAuthAndAddress(\n          uploadInfo,\n          uploadAuthInfo.uploadAuth,\n          uploadAuthInfo.uploadAddress,\n          uploadAuthInfo.videoId || uploadAuthInfo.imageId\n        )\n      },\n      // 文件上传成功\n      onUploadSucceed: function (uploadInfo: any) {\n        console.log('onUploadSucceed', uploadInfo)\n      },\n      // 文件上传失败\n      onUploadFailed: function (uploadInfo: any, code: any, message: any) {\n        console.log('onUploadFailed', uploadInfo, code, message)\n      },\n      // 文件上传进度，单位：字节\n      onUploadProgress: function (\n        uploadInfo: any,\n        totalSize: any,\n        loadedPercent: any\n      ) {\n        console.log(uploadInfo, totalSize, loadedPercent)\n      },\n      // 上传凭证超时\n      onUploadTokenExpired: function (uploadInfo: any) {\n        console.log('onUploadTokenExpired')\n      },\n      // 全部文件上传结束\n      onUploadEnd: async (uploadInfo: any) => {\n        this.isUploadSuccess = true\n        const { data } = await transCodeVideo({\n          lessonId: this.$route.query.lessonId,\n          fileId: this.videoId,\n          coverImageUrl: this.imageUrl,\n          fileName: this.fileName\n        })\n        if (data.code === '000000') {\n          const timer = setInterval(async () => {\n            const { data } = await getAliyunTransCodePercent(\n              (this.$route.query as any).lessonId\n            )\n            // console.log('转码进度', data)\n            if (data.code === '000000') {\n              this.isTranscodeSuccess = true\n              this.$message.success('视频转码成功')\n              clearInterval(timer)\n            }\n          }, 1000)\n        }\n      }\n    })\n  }\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./video.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./video.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./video.vue?vue&type=template&id=a1431a2c&scoped=true&\"\nimport script from \"./video.vue?vue&type=script&lang=ts&\"\nexport * from \"./video.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"a1431a2c\",\n  null\n  \n)\n\nexport default component.exports","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.es/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n"],"sourceRoot":""}